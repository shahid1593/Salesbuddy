<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBI Super Health Insurance Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #280071;
            --secondary: #0091d0;
            --light-bg: #f8f9fa;
            --border: #dee2e6;
            --active-pill: #0091d0;
            --inactive-pill: #e9ecef;
            --discount-green: #2ecc71;
            --whatsapp: #25D366;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #e9ecef;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 { margin: 0; font-size: 24px; }

        .content { padding: 30px; }

        .form-group { margin-bottom: 20px; }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: #444;
        }

        .pill-container {
            display: flex;
            background-color: var(--inactive-pill);
            border-radius: 25px;
            padding: 5px;
            width: fit-content;
            margin-bottom: 10px;
        }

        .pill-option {
            padding: 10px 25px;
            cursor: pointer;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            color: #666;
        }

        .pill-option.active {
            background-color: var(--active-pill);
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            border-color: var(--secondary);
            outline: none;
        }

        .btn-calc {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }

        .btn-calc:hover { background-color: #007bb5; }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-download, .btn-whatsapp {
            flex: 1;
            border: none;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .btn-download { background-color: #28a745; }
        .btn-download:hover { background-color: #218838; }

        .btn-whatsapp { background-color: var(--whatsapp); }
        .btn-whatsapp:hover { background-color: #128C7E; }

        #resultArea {
            margin-top: 40px;
            display: none;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .plan-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
            position: relative;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .plan-header {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 10px;
        }

        .price-row {
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .discount-badge {
            background-color: #e8f5e9;
            color: var(--discount-green);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .final-price {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-top: 15px;
        }

        .opt-section {
            border-top: 1px dashed #ccc;
            padding-top: 20px;
            margin-top: 20px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
            margin-bottom: 8px;
        }
        .checkbox-label input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }
        .checkbox-label.disabled {
            color: #aaa;
            cursor: not-allowed;
        }

        .error-msg {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 5px;
        }

        .note {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }
        
        .opt-note {
            margin-left: 28px;
            font-size: 12px;
            color: #e74c3c;
            display: none;
            margin-bottom: 5px;
        }

        @media (max-width: 600px) {
            .comparison-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Super Health Insurance Calculator</h1>
    </div>

    <div class="content">
        <form id="calcForm">
            <div class="form-group">
                <label>Plan Variant</label>
                <select id="variant" onchange="handleVariantChange()">
                    <option value="Prime">Prime</option>
                    <option value="Elite">Elite</option>
                    <option value="Premier">Premier</option>
                    <option value="Platinum">Platinum</option>
                    <option value="PlatinumInfinite">Platinum Infinite</option>
                </select>
            </div>

            <div class="form-group">
                <label>Policy Type</label>
                <div class="pill-container">
                    <div class="pill-option active" id="pill-individual" onclick="setPolicyType('individual')">Individual</div>
                    <div class="pill-option" id="pill-floater" onclick="setPolicyType('floater')">Family Floater</div>
                </div>
                <input type="hidden" id="policyType" value="individual">
            </div>

            <div class="form-group">
                <label>Family Combination</label>
                <select id="family">
                    </select>
            </div>

            <div class="form-group">
                <label id="ageLabel">Age of Eldest Member (Years)</label>
                <input type="number" id="age" min="18" max="99" placeholder="e.g. 35" required>
            </div>

            <div class="form-group">
                <label>Sum Insured (INR)</label>
                <select id="sumInsured">
                    </select>
            </div>

            <div class="opt-section">
                <label style="color: var(--secondary);">Optional Benefits</label>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="opt_domestic"> Domestic Help / Staff Cover
                </label>
                <div id="domestic_inputs" style="display:none; margin-left: 28px; margin-bottom: 10px;">
                    <input type="number" id="staff_age" placeholder="Staff Age (18-65)" style="width: 150px; padding: 5px; margin-bottom: 5px;">
                    <select id="staff_si" style="width: 150px; padding: 5px;">
                        <option value="50000">50k SI</option>
                        <option value="100000">1L SI</option>
                    </select>
                </div>

                <label class="checkbox-label" id="lbl_reinsure">
                    <input type="checkbox" id="opt_reinsure"> Enhanced ReInsure Benefit
                </label>
                <div id="reinsure_note" class="opt-note">Not applicable for Platinum Infinite</div>
                
                <label class="checkbox-label" id="lbl_bonus">
                    <input type="checkbox" id="opt_bonus"> Enhanced Cumulative Bonus Safeguard
                </label>
                <div id="bonus_note" class="opt-note">Not applicable for Platinum Infinite</div>

                <label class="checkbox-label">
                    <input type="checkbox" id="opt_accident"> Accident Related Hospitalization
                </label>

                <label class="checkbox-label" id="lbl_wellness">
                    <input type="checkbox" id="opt_wellness"> Wellness Benefit (Gym Membership)
                </label>
            </div>

            <button type="button" class="btn-calc" onclick="calculate()">Calculate Premium</button>
            <div id="errorBox" class="error-msg"></div>
        </form>

        <div id="resultArea">
            <h3 style="text-align: center; color: var(--primary);">Total Premium (Excl. Tax)</h3>
            <div class="comparison-container">
                <div class="plan-card">
                    <div class="plan-header">1 Year Policy</div>
                    <div class="price-row">Base: <span id="base_1">0</span></div>
                    <div class="price-row">Optional: <span id="opt_1">0</span></div>
                    <div class="discount-badge">No Discount</div>
                    <div class="final-price" id="total_1">₹ 0</div>
                </div>
                <div class="plan-card" style="border-color: var(--secondary); background: #f0faff;">
                    <div class="plan-header">2 Year Policy</div>
                    <div class="price-row">Total Base: <span id="base_2">0</span></div>
                    <div class="price-row">Optional: <span id="opt_2">0</span></div>
                    <div class="discount-badge">4% Term Discount</div>
                    <div class="final-price" id="total_2">₹ 0</div>
                </div>
                <div class="plan-card">
                    <div class="plan-header">3 Year Policy</div>
                    <div class="price-row">Total Base: <span id="base_3">0</span></div>
                    <div class="price-row">Optional: <span id="opt_3">0</span></div>
                    <div class="discount-badge">6% Term Discount</div>
                    <div class="final-price" id="total_3">₹ 0</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn-download" id="btnDownload" onclick="generateAndAction('download')">Download Quote (PDF)</button>
                <button class="btn-whatsapp" id="btnWhatsapp" onclick="generateAndAction('whatsapp')">Share on WhatsApp</button>
            </div>
            <div class="note" id="calcNote"></div>
        </div>
    </div>
</div>

<script>
    // --- DATABASE (Base Rates) ---
    // NOTE: Platinum rates and SI options are now fully populated based on Premier structure (10L-50L)
    const db = {
        "Prime": { "SI": [300000, 500000, 700000, 1000000, 1500000, 2000000, 2500000], "rates": { "1A": { "18-35": [6928, 7904, 8790, 9313, 10378, 11437, 12398], "36-45": [8114, 9242, 10285, 10904, 12122, 13348, 14462], "46-50": [11873, 13349, 14706, 15635, 16994, 18684, 20404], "51-55": [15247, 17158, 18959, 20161, 21957, 24124, 26279], "56-60": [20313, 22799, 25188, 26572, 29127, 31925, 34477], "61-65": [26233, 29481, 32649, 34512, 37960, 41594, 44911], "66-70": [34074, 38332, 42530, 45028, 49491, 54232, 58563], "71-75": [44458, 50053, 55617, 58956, 64764, 70972, 76644], "76-80": [58212, 65578, 72950, 77403, 84992, 93142, 100592], "81-85": [76428, 86140, 95907, 101835, 111783, 122506, 132310], "85+": [100554, 113373, 126312, 134194, 147266, 161396, 174318] }, "1A1C": { "18-35": [9903, 11417, 12788, 13628, 15319, 16911, 18355], "36-45": [10971, 12622, 14133, 15060, 16888, 18632, 20214], "46-50": [14400, 16357, 18141, 19351, 21277, 23438, 25583], "51-55": [19790, 22422, 24896, 26532, 29137, 32040, 34863], "56-60": [24408, 27559, 30562, 32342, 35650, 39120, 42283], "61-65": [29736, 33573, 37276, 39488, 43612, 47835, 51686], "66-70": [36793, 41538, 46169, 48953, 53990, 59210, 63973], "71-75": [46796, 52833, 58783, 62380, 68757, 75399, 81460], "76-80": [62064, 70079, 78051, 82898, 91463, 100299, 108361], "81-85": [81694, 92244, 102809, 109257, 120578, 132224, 142847], "85+": [106491, 120222, 134052, 142515, 157199, 172370, 186213] }, "1A2C": { "18-35": [13370, 15500, 17430, 18636, 21037, 23245, 25246], "36-45": [14426, 16691, 18760, 20051, 22589, 24946, 27083], "46-50": [17822, 20390, 22727, 24298, 26930, 29700, 32395], "51-55": [25480, 28998, 32305, 34475, 38062, 41874, 45523], "56-60": [30055, 34085, 37915, 40225, 44508, 48883, 52865], "61-65": [35323, 40032, 44555, 47292, 52384, 57502, 62165], "66-70": [42301, 47908, 53349, 56651, 62646, 68750, 74315], "71-75": [51544, 58341, 64996, 69047, 76239, 83648, 90408], "76-80": [63784, 72158, 80423, 85465, 94242, 103380, 111721], "81-85": [82350, 93125, 103843, 110401, 121743, 133534, 144296], "85+": [107270, 121266, 135275, 143863, 158637, 173985, 187993] }, "1A3C": { "18-35": [16760, 19492, 21968, 23530, 26627, 29435, 31980], "36-45": [17803, 20670, 23283, 24930, 28161, 31118, 33797], "46-50": [21167, 24331, 27208, 29132, 32453, 35818, 39051], "51-55": [31045, 35427, 39548, 42239, 46785, 51486, 55942], "56-60": [35574, 40463, 45101, 47930, 53166, 58422, 63206], "61-65": [40784, 46343, 51667, 54917, 60954, 66946, 72403], "66-70": [47684, 54132, 60362, 64171, 71101, 78068, 84416], "71-75": [56822, 64447, 71879, 76428, 84541, 92798, 100328], "76-80": [68925, 78108, 87132, 92661, 102342, 112308, 121402], "81-85": [84955, 96203, 107334, 114161, 125918, 138148, 149313], "85+": [107679, 121860, 135986, 144661, 159453, 174911, 189026] }, "2A": { "18-35": [10106, 11555, 12887, 13696, 15325, 16941, 18392], "36-45": [11838, 13509, 15069, 16018, 17831, 19621, 21248], "46-50": [17107, 19322, 21396, 22958, 24926, 27394, 30002], "51-55": [22034, 24883, 27605, 29566, 32173, 35336, 38581], "56-60": [29753, 33441, 37021, 39149, 42962, 47047, 50774], "61-65": [38395, 43197, 47914, 50742, 55927, 61232, 66076], "66-70": [49843, 56119, 62340, 66095, 72762, 79685, 86008], "71-75": [65004, 73232, 81447, 86430, 95060, 104124, 112406], "76-80": [85084, 95898, 106753, 113362, 124593, 136493, 147370], "81-85": [111680, 125919, 140271, 149033, 163708, 179363, 193678], "85+": [146905, 165679, 184662, 196278, 215514, 236144, 255010] }, "2A1C": { "18-35": [12892, 14833, 16612, 17711, 19869, 21905, 23752], "36-45": [14600, 16761, 18764, 20002, 22381, 24658, 26726], "46-50": [19804, 22499, 25007, 26853, 29379, 32324, 35365], "51-55": [26572, 30121, 33501, 35884, 39268, 43150, 47047], "56-60": [34201, 38578, 42805, 45347, 49926, 54717, 59085], "61-65": [42726, 48201, 53548, 56781, 62716, 68711, 74181], "66-70": [54016, 60945, 67777, 71924, 79322, 86911, 93839], "71-75": [68970, 77824, 86622, 91980, 101314, 111016, 119876], "76-80": [88775, 100180, 111582, 118544, 130442, 142941, 154361], "81-85": [115006, 129789, 144640, 153726, 169021, 185224, 200034], "85+": [151952, 169005, 188423, 200323, 220117, 241227, 260527] }, "2A2C": { "18-35": [15601, 18020, 20231, 21614, 24324, 26837, 29115], "36-45": [17285, 19921, 22354, 23873, 26801, 29551, 32047], "46-50": [22423, 25585, 28515, 30636, 33702, 37112, 40572], "51-55": [30984, 35212, 39231, 42023, 46162, 50741, 55272], "56-60": [38523, 43568, 48422, 51367, 56689, 62165, 67154], "61-65": [46929, 53057, 59016, 62641, 69305, 75968, 82044], "66-70": [58063, 65624, 73047, 77574, 85679, 93915, 101429], "71-75": [72809, 82269, 91630, 97352, 107366, 117684, 127105], "76-80": [92339, 104314, 116243, 123546, 136090, 149166, 161110], "81-85": [118206, 133512, 148842, 158240, 174133, 190863, 206149], "85+": [152466, 172183, 192018, 204190, 224519, 246087, 265801] }, "2A3C": { "18-35": [18233, 21115, 23747, 25404, 28650, 31625, 34321], "36-45": [19893, 22989, 25839, 27631, 31091, 34301, 37212], "46-50": [24966, 28579, 31917, 34306, 37896, 41756, 45622], "51-55": [35269, 40156, 44794, 47983, 52854, 58110, 63255], "56-60": [42719, 48411, 53872, 57207, 63249, 69389, 74981], "61-65": [51006, 57766, 64317, 68323, 75691, 83002, 89665], "66-70": [61983, 70157, 78151, 83045, 91835, 100696, 108777], "71-75": [76521, 86567, 96472, 102544, 113217, 124131, 134091], "76-80": [95777, 108302, 120739, 128370, 141536, 155169, 167618], "81-85": [121279, 137088, 152878, 162575, 179043, 196278, 212022], "85+": [155056, 175215, 195446, 207878, 228720, 250725, 270834] } } }, "Elite": { "SI": [300000, 500000, 700000, 1000000, 1500000, 2000000, 2500000], "rates": { "1A": { "18-35": [7203, 8214, 9138, 9685, 10835, 11940, 12941], "36-45": [9282, 10560, 11763, 12485, 14066, 15489, 16774], "46-50": [14418, 16222, 17930, 19083, 21232, 23352, 25446], "51-55": [18493, 20821, 23069, 24557, 27360, 30074, 32707], "56-60": [24432, 27448, 30404, 32150, 35984, 39477, 42635], "61-65": [33945, 38186, 42415, 44956, 50798, 55734, 60186], "66-70": [47955, 54000, 60109, 63828, 72600, 79685, 86057], "71-75": [68056, 76690, 85501, 90917, 104049, 114242, 123383], "76-80": [93609, 105533, 117777, 125344, 143920, 158047, 170701], "81-85": [120674, 136084, 151940, 161761, 185443, 203637, 219945], "85+": [151438, 170809, 190751, 203110, 231975, 254697, 275099] }, "1A1C": { "18-35": [10225, 11779, 13195, 14064, 15853, 17500, 18992], "36-45": [12095, 13891, 15557, 16583, 18761, 20694, 22441], "46-50": [16766, 19027, 21136, 22554, 25214, 27775, 30267], "51-55": [22957, 25998, 28908, 30822, 34411, 37849, 41138], "56-60": [28362, 32022, 35569, 37698, 42232, 46371, 50114], "61-65": [36924, 41686, 46379, 49223, 55578, 61015, 65922], "66-70": [49533, 55919, 62304, 66208, 75200, 82571, 89206], "71-75": [68281, 77085, 85992, 91479, 104526, 114795, 124015], "76-80": [94169, 106318, 118708, 126380, 144910, 159167, 171948], "81-85": [121763, 137473, 153552, 163526, 187284, 205695, 222209], "85+": [152533, 172193, 192360, 204874, 233849, 256794, 277405] }, "1A2C": { "18-35": [13761, 15941, 17925, 19165, 21688, 23962, 26020], "36-45": [15611, 18030, 20262, 21657, 24563, 27120, 29431], "46-50": [20235, 23113, 25782, 27565, 30946, 34123, 37173], "51-55": [28858, 32810, 36582, 39048, 43684, 48066, 52212], "56-60": [34209, 38774, 43176, 45852, 51425, 56500, 61094], "61-65": [42676, 48331, 53866, 57250, 64623, 70983, 76727], "66-70": [55144, 62405, 69613, 74046, 84027, 92300, 99753], "71-75": [73035, 82599, 92212, 98154, 112017, 123055, 132973], "76-80": [95777, 108270, 120938, 128795, 147502, 162042, 175086], "81-85": [122218, 138127, 154332, 164397, 188114, 206637, 223260], "85+": [153045, 172936, 193244, 205860, 234842, 257919, 278656] }, "1A3C": { "18-35": [17219, 20010, 22550, 24152, 27391, 30277, 32889], "36-45": [19048, 22075, 24860, 26616, 30233, 33400, 36262], "46-50": [23625, 27105, 30321, 32461, 36545, 40324, 43919], "51-55": [34626, 39469, 44083, 47088, 52746, 58051, 63034], "56-60": [39924, 45373, 50609, 53820, 60406, 66397, 71820], "61-65": [48295, 54822, 61179, 65090, 73458, 80719, 87280], "66-70": [60624, 68738, 76750, 81697, 92644, 101796, 110046], "71-75": [78313, 88705, 99095, 105535, 120319, 132205, 142894], "76-80": [100800, 114087, 127497, 135831, 155405, 170754, 184533], "81-85": [124617, 140972, 157561, 167878, 191945, 210873, 227868], "85+": [153181, 173221, 193610, 206288, 235204, 258346, 279149] }, "2A": { "18-35": [10507, 12007, 13395, 14239, 15952, 17565, 19028], "36-45": [13542, 15433, 17227, 18326, 20669, 22746, 24624], "46-50": [20824, 23517, 26103, 27992, 31114, 34209, 37363], "51-55": [26773, 30231, 33606, 35983, 40060, 44024, 47965], "56-60": [35766, 40229, 44637, 47294, 52973, 58074, 62684], "61-65": [49655, 55906, 62172, 65991, 74671, 81877, 88376], "66-70": [70109, 78995, 88006, 93544, 106502, 116846, 126148], "71-75": [99457, 112122, 125079, 133093, 152417, 167298, 180645], "76-80": [136764, 154233, 172201, 183357, 210628, 231254, 249728], "81-85": [176280, 198837, 222079, 236526, 271252, 297815, 321625], "85+": [221194, 249535, 278743, 296895, 339189, 372363, 402150] }, "2A1C": { "18-35": [13347, 15346, 17187, 18327, 20626, 22739, 24653], "36-45": [16340, 18725, 20967, 22359, 25278, 27849, 30173], "46-50": [23529, 26704, 29725, 31898, 35580, 39155, 42743], "51-55": [31443, 35619, 39670, 42481, 47377, 52081, 56695], "56-60": [40330, 45496, 50566, 53648, 60129, 65955, 71224], "61-65": [54028, 60959, 67862, 72089, 81533, 89436, 96567], "66-70": [74203, 83731, 93341, 99264, 112928, 123926, 133822], "71-75": [103149, 116404, 129906, 138272, 158214, 173687, 187572], "76-80": [139945, 157939, 176383, 187847, 215628, 236767, 255709], "81-85": [178919, 201932, 225578, 240288, 275421, 302416, 326621], "85+": [223218, 251935, 281465, 299830, 342428, 375943, 406043] }, "2A2C": { "18-35": [16108, 18592, 20873, 22301, 25168, 27766, 30119], "36-45": [19060, 21924, 24601, 26276, 29755, 32805, 35562], "46-50": [22423, 25585, 28515, 30636, 33702, 37112, 40572], "51-55": [35982, 40854, 45561, 48792, 54483, 59906, 65172], "56-60": [44762, 50610, 56322, 59816, 67074, 73604, 79510], "61-65": [58270, 65858, 73377, 78001, 88184, 96762, 104505], "66-70": [78164, 88314, 98503, 104799, 119143, 130773, 141242], "71-75": [106708, 120533, 134560, 143264, 151556, 168062, 184568], "76-80": [142993, 161491, 180391, 192151, 220417, 242046, 261436], "81-85": [118206, 133512, 148842, 158240, 174133, 190863, 206149], "85+": [152466, 172183, 192018, 204190, 224519, 246087, 265801] }, "2A3C": { "18-35": [18790, 21745, 24453, 26159, 29578, 32647, 35425], "36-45": [21700, 25029, 28128, 30078, 34100, 37615, 40792], "46-50": [28703, 32798, 36650, 39367, 44117, 48608, 53024], "51-55": [40389, 45935, 51278, 54918, 61378, 67498, 73396], "56-60": [49062, 55571, 61905, 65798, 73809, 81020, 87544], "61-65": [62380, 70604, 78720, 83726, 94625, 103856, 112190], "66-70": [81994, 92744, 103492, 110147, 125148, 137387, 148410], "71-75": [110135, 124509, 139041, 148071, 156676, 173792, 190908], "76-80": [145909, 164890, 184226, 196269, 207740, 230628, 253516], "81-85": [184564, 208424, 232819, 247250, 261681, 290543, 319405], "85+": [227813, 257219, 286390, 305141, 348273, 382404, 413069] } } }, "Premier": { "SI": [1000000, 1500000, 2000000, 2500000, 3000000, 4000000, 5000000], "rates": { "1A": { "18-35": [12596, 13607, 14531, 15039, 15547, 16564, 17580], "36-45": [13890, 15168, 16371, 17046, 17721, 19070, 20419], "46-50": [17188, 18992, 20700, 21604, 22507, 24314, 26120], "51-55": [19691, 22019, 24267, 25484, 26701, 29135, 31568], "56-60": [24591, 27608, 30564, 32190, 33816, 37068, 40320], "61-65": [34128, 38370, 42598, 44981, 47364, 52129, 56895], "66-70": [48169, 54215, 60324, 63833, 67341, 74358, 81374], "71-75": [68311, 76945, 85757, 90893, 96029, 106300, 116571], "76-80": [93917, 105842, 118085, 125283, 132481, 146877, 161273], "81-85": [121052, 136461, 152318, 161650, 170982, 189645, 208309], "85+": [151905, 171276, 191218, 202929, 214640, 238062, 261483] }, "1A1C": { "18-35": [13465, 15019, 16435, 17248, 18060, 19685, 21310], "36-45": [14877, 16673, 18339, 19303, 20268, 22197, 24126], "46-50": [18470, 20731, 22841, 23996, 25151, 27461, 29771], "51-55": [23750, 26791, 29701, 31317, 32933, 36165, 39397], "56-60": [28552, 32211, 35758, 37744, 39730, 43702, 47674], "61-65": [37137, 41899, 46592, 49258, 51923, 57255, 62586], "66-70": [49777, 56163, 62548, 66228, 69908, 77268, 84628], "71-75": [68566, 77370, 86277, 91476, 96675, 107073, 117471], "76-80": [94507, 106656, 119046, 126336, 133626, 148206, 162786], "81-85": [122170, 137880, 153959, 163429, 172899, 191839, 210779], "85+": [153015, 172690, 192857, 204710, 216563, 240269, 263975] }, "1A2C": { "18-35": [14693, 16873, 18857, 20022, 21187, 23517, 25847], "36-45": [16435, 18853, 21085, 22398, 23711, 26337, 28963], "46-50": [20797, 23675, 26344, 27845, 29346, 32348, 35350], "51-55": [29214, 33166, 36938, 39074, 41210, 45482, 49754], "56-60": [34428, 38993, 43395, 45895, 48395, 53395, 58395], "61-65": [42918, 48574, 54108, 57282, 60456, 66804, 73152], "66-70": [55419, 62679, 69887, 74063, 78239, 86591, 94943], "71-75": [73349, 82914, 92527, 98152, 103777, 115027, 126277], "76-80": [96144, 108637, 121305, 128764, 136223, 151141, 166059], "81-85": [122655, 138564, 154769, 164319, 173869, 192969, 212069], "85+": [153572, 173463, 193771, 205716, 217661, 241551, 265441] }, "1A3C": { "18-35": [17474, 20266, 22805, 24313, 25821, 28837, 31853], "36-45": [19300, 22327, 25112, 26766, 28420, 31728, 35036], "46-50": [23861, 27341, 30556, 32396, 34236, 37916, 41596], "51-55": [34872, 39715, 44329, 46971, 49613, 54897, 60181], "56-60": [40172, 45621, 50858, 53861, 56864, 62870, 68876], "61-65": [48568, 55094, 61451, 65120, 68789, 76127, 83465], "66-70": [60928, 69042, 77053, 81713, 86373, 95693, 105013], "71-75": [78658, 89050, 99439, 105531, 111623, 123807, 135991], "76-80": [101197, 114485, 127895, 135801, 143707, 159519, 175331], "81-85": [125084, 141438, 158028, 167812, 177596, 197164, 216732], "85+": [153737, 173778, 194166, 206165, 218164, 242162, 266160] }, "2A": { "18-35": [16861, 18362, 19749, 20536, 21323, 22897, 24471], "36-45": [18980, 20871, 22666, 23696, 24726, 26786, 28846], "46-50": [24108, 26801, 29386, 30814, 32242, 35098, 37954], "51-55": [28219, 31678, 35052, 36936, 38820, 42588, 46356], "56-60": [36006, 40469, 44877, 47359, 49841, 54805, 59769], "61-65": [49943, 56194, 62460, 66047, 69634, 76808, 83982], "66-70": [70460, 79345, 88356, 93587, 98818, 109280, 119742], "71-75": [99889, 112554, 125510, 133117, 140724, 155938, 171152], "76-80": [137302, 154771, 172738, 183355, 193972, 215206, 236440], "81-85": [176955, 199513, 222755, 236488, 250221, 277687, 305153], "85+": [222050, 250391, 279598, 296804, 314010, 348422, 382834] }, "2A1C": { "18-35": [16862, 18615, 20456, 21523, 22590, 24724, 26858], "36-45": [19159, 21544, 23786, 25094, 26402, 29018, 31634], "46-50": [25281, 28456, 31477, 33174, 34871, 38265, 41659], "51-55": [32298, 36473, 40524, 42815, 45106, 49688, 54270], "56-60": [40599, 45766, 50835, 53716, 56597, 62359, 68121], "61-65": [54345, 61276, 68179, 72149, 76119, 84059, 91999], "66-70": [74582, 84111, 93721, 99313, 104905, 116089, 127273], "71-75": [103609, 116865, 130367, 138303, 146239, 162111, 177983], "76-80": [140511, 158505, 176949, 187854, 198759, 220569, 242379], "81-85": [179624, 202636, 226283, 240261, 254239, 282195, 310151], "85+": [224103, 252820, 282350, 299754, 317158, 351966, 386774] }, "2A2C": { "18-35": [17068, 19552, 21833, 23172, 24511, 27189, 29867], "36-45": [19919, 22784, 25461, 27037, 28613, 31765, 34917], "46-50": [26765, 30407, 33850, 35809, 37768, 41686, 45604], "51-55": [36399, 41271, 45978, 48664, 51350, 56722, 62094], "56-60": [45060, 50909, 56621, 59889, 63157, 69693, 76229], "61-65": [58616, 66205, 73724, 78066, 82408, 91092, 99776], "66-70": [78573, 88723, 98912, 104853, 110794, 122676, 134558], "71-75": [107198, 121024, 135050, 143303, 151556, 168062, 184568], "76-80": [143589, 162087, 180987, 192168, 203349, 225711, 248073], "81-85": [182160, 205607, 229638, 243848, 258058, 286478, 314898], "85+": [226024, 255096, 284928, 302517, 320106, 355284, 390462] }, "2A3C": { "18-35": [19073, 22028, 24736, 26339, 27942, 31148, 34354], "36-45": [21988, 25317, 28416, 30253, 32090, 35764, 39438], "46-50": [28985, 33080, 36932, 39145, 41358, 45784, 50210], "51-55": [40695, 46242, 51585, 54654, 57723, 63861, 69999], "56-60": [49389, 55899, 62233, 65876, 69519, 76805, 84091], "61-65": [62755, 70980, 79096, 83798, 88500, 97904, 107308], "66-70": [82432, 93182, 103930, 110209, 116488, 129046, 141604], "71-75": [110655, 125029, 139560, 148118, 156676, 173792, 190908], "76-80": [146535, 165515, 184852, 196296, 207740, 230628, 253516], "81-85": [184564, 208424, 232819, 247250, 261681, 290543, 319405], "85+": [227813, 257219, 287333, 305096, 322859, 358385, 393911] } } }, "Platinum": { "SI": [1000000, 1500000, 2000000, 2500000, 3000000, 4000000, 5000000], "rates": { "1A": { "18-35": [12596, 13607, 14531, 15039, 15547, 16564, 17580], "36-45": [13890, 15168, 16371, 17046, 17721, 19070, 20419], "46-50": [17188, 18992, 20700, 21604, 22507, 24314, 26120], "51-55": [19691, 22019, 24267, 25484, 26701, 29135, 31568], "56-60": [24591, 27608, 30564, 32190, 33816, 37068, 40320], "61-65": [34128, 38370, 42598, 44981, 47364, 52129, 56895], "66-70": [48169, 54215, 60324, 63833, 67341, 74358, 81374], "71-75": [68311, 76945, 85757, 90893, 96029, 106300, 116571], "76-80": [93917, 105842, 118085, 125283, 132481, 146877, 161273], "81-85": [121052, 136461, 152318, 161650, 170982, 189645, 208309], "85+": [151905, 171276, 191218, 202929, 214640, 238062, 261483] }, "1A1C": { "18-35": [13465, 15019, 16435, 17248, 18060, 19685, 21310], "36-45": [14877, 16673, 18339, 19303, 20268, 22197, 24126], "46-50": [18470, 20731, 22841, 23996, 25151, 27461, 29771], "51-55": [23750, 26791, 29701, 31317, 32933, 36165, 39397], "56-60": [28552, 32211, 35758, 37744, 39730, 43702, 47674], "61-65": [37137, 41899, 46592, 49258, 51923, 57255, 62586], "66-70": [49777, 56163, 62548, 66228, 69908, 77268, 84628], "71-75": [68566, 77370, 86277, 91476, 96675, 107073, 117471], "76-80": [94507, 106656, 119046, 126336, 133626, 148206, 162786], "81-85": [122170, 137880, 153959, 163429, 172899, 191839, 210779], "85+": [153015, 172690, 192857, 204710, 216563, 240269, 263975] }, "1A2C": { "18-35": [14693, 16873, 18857, 20022, 21187, 23517, 25847], "36-45": [16435, 18853, 21085, 22398, 23711, 26337, 28963], "46-50": [20797, 23675, 26344, 27845, 29346, 32348, 35350], "51-55": [29214, 33166, 36938, 39074, 41210, 45482, 49754], "56-60": [34428, 38993, 43395, 45895, 48395, 53395, 58395], "61-65": [42918, 48574, 54108, 57282, 60456, 66804, 73152], "66-70": [55419, 62679, 69887, 74063, 78239, 86591, 94943], "71-75": [73349, 82914, 92527, 98152, 103777, 115027, 126277], "76-80": [96144, 108637, 121305, 128764, 136223, 151141, 166059], "81-85": [122655, 138564, 154769, 164319, 173869, 192969, 212069], "85+": [153572, 173463, 193771, 205716, 217661, 241551, 265441] }, "1A3C": { "18-35": [17474, 20266, 22805, 24313, 25821, 28837, 31853], "36-45": [19300, 22327, 25112, 26766, 28420, 31728, 35036], "46-50": [23861, 27341, 30556, 32396, 34236, 37916, 41596], "51-55": [34872, 39715, 44329, 46971, 49613, 54897, 60181], "56-60": [40172, 45621, 50858, 53861, 56864, 62870, 68876], "61-65": [48568, 55094, 61451, 65120, 68789, 76127, 83465], "66-70": [60928, 69042, 77053, 81713, 86373, 95693, 105013], "71-75": [78658, 89050, 99439, 105531, 111623, 123807, 135991], "76-80": [101197, 114485, 127895, 135801, 143707, 159519, 175331], "81-85": [125084, 141438, 158028, 167812, 177596, 197164, 216732], "85+": [153737, 173778, 194166, 206165, 218164, 242162, 266160] }, "2A": { "18-35": [16861, 18362, 19749, 20536, 21323, 22897, 24471], "36-45": [18980, 20871, 22666, 23696, 24726, 26786, 28846], "46-50": [24108, 26801, 29386, 30814, 32242, 35098, 37954], "51-55": [28219, 31678, 35052, 36936, 38820, 42588, 46356], "56-60": [36006, 40469, 44877, 47359, 49841, 54805, 59769], "61-65": [49943, 56194, 62460, 66047, 69634, 76808, 83982], "66-70": [70460, 79345, 88356, 93587, 98818, 109280, 119742], "71-75": [99889, 112554, 125510, 133117, 140724, 155938, 171152], "76-80": [137302, 154771, 172738, 183355, 193972, 215206, 236440], "81-85": [176955, 199513, 222755, 236488, 250221, 277687, 305153], "85+": [222050, 250391, 279598, 296804, 314010, 348422, 382834] }, "2A1C": { "18-35": [16862, 18615, 20456, 21523, 22590, 24724, 26858], "36-45": [19159, 21544, 23786, 25094, 26402, 29018, 31634], "46-50": [25281, 28456, 31477, 33174, 34871, 38265, 41659], "51-55": [32298, 36473, 40524, 42815, 45106, 49688, 54270], "56-60": [40599, 45766, 50835, 53716, 56597, 62359, 68121], "61-65": [54345, 61276, 68179, 72149, 76119, 84059, 91999], "66-70": [74582, 84111, 93721, 99313, 104905, 116089, 127273], "71-75": [103609, 116865, 130367, 138303, 146239, 162111, 177983], "76-80": [140511, 158505, 176949, 187854, 198759, 220569, 242379], "81-85": [179624, 202636, 226283, 240261, 254239, 282195, 310151], "85+": [223218, 251935, 281465, 299830, 342428, 375943, 406043] }, "2A2C": { "18-35": [17068, 19552, 21833, 23172, 24511, 27189, 29867], "36-45": [19919, 22784, 25461, 27037, 28613, 31765, 34917], "46-50": [26765, 30407, 33850, 35809, 37768, 41686, 45604], "51-55": [36399, 41271, 45978, 48664, 51350, 56722, 62094], "56-60": [45060, 50909, 56621, 59889, 63157, 69693, 76229], "61-65": [58616, 66205, 73724, 78066, 82408, 91092, 99776], "66-70": [78573, 88723, 98912, 104853, 110794, 122676, 134558], "71-75": [107198, 121024, 135050, 143303, 151556, 168062, 184568], "76-80": [143589, 162087, 180987, 192168, 203349, 225711, 248073], "81-85": [182160, 205607, 229638, 243848, 258058, 286478, 314898], "85+": [226024, 255096, 284928, 302517, 320106, 355284, 390462] }, "2A3C": { "18-35": [19073, 22028, 24736, 26339, 27942, 31148, 34354], "36-45": [21988, 25317, 28416, 30253, 32090, 35764, 39438], "46-50": [28985, 33080, 36932, 39145, 41358, 45784, 50210], "51-55": [40695, 46242, 51585, 54654, 57723, 63861, 69999], "56-60": [49389, 55899, 62233, 65876, 69519, 76805, 84091], "61-65": [62755, 70980, 79096, 83798, 88500, 97904, 107308], "66-70": [81994, 92744, 103492, 110147, 125148, 137387, 148410], "71-75": [110655, 125029, 139560, 148118, 156676, 173792, 190908], "76-80": [145909, 164890, 184226, 196269, 207740, 230628, 253516], "81-85": [184564, 208424, 232819, 247250, 261681, 290543, 319405], "85+": [227813, 257219, 286390, 305141, 348273, 382404, 413069] } } }, "PlatinumInfinite": { "SI": [5000000, 7500000, 10000000, 20000000], "rates": { "1A": { "18-35": [45944, 47220, 48152, 51518], "36-45": [46749, 48525, 49853, 54754], "46-50": [47859, 51876, 53984, 61893], "51-55": [48608, 53410, 56107, 66279], "56-60": [54676, 60499, 63962, 77071], "61-65": [76124, 84139, 89322, 109087], "66-70": [108259, 119669, 127549, 157761], "71-75": [154892, 171334, 183237, 229051], "76-80": [213830, 236566, 253484, 318740], "81-85": [274017, 302743, 324325, 407589], "85+": [340322, 375225, 401499, 502808] }, "1A1C": { "18-35": [47694, 49573, 50946, 55845], "36-45": [49657, 51987, 53716, 59996], "46-50": [53551, 58022, 60453, 69441], "51-55": [63163, 68756, 72022, 84207], "56-60": [70279, 76792, 80746, 95575], "61-65": [89592, 98077, 103580, 124399], "66-70": [118526, 130066, 137997, 168218], "71-75": [160512, 176581, 188132, 232395], "76-80": [217618, 239761, 256148, 319143], "81-85": [278010, 306172, 327244, 408330], "85+": [346401, 380973, 406926, 506787] }, "1A2C": { "18-35": [48222, 50934, 52914, 59941], "36-45": [50302, 53329, 55567, 63626], "46-50": [58174, 63332, 66265, 77001], "51-55": [77547, 84228, 88286, 103331], "56-60": [86882, 94471, 99211, 116871], "61-65": [105982, 115521, 121792, 145376], "66-70": [134595, 147157, 155828, 188709], "71-75": [176117, 193156, 205408, 252175], "76-80": [228595, 251236, 267952, 332022], "81-85": [282191, 310165, 331030, 411128], "85+": [350478, 385009, 410916, 510410] }, "1A3C": { "18-35": [53239, 56507, 58895, 67340], "36-45": [57381, 61089, 63825, 73621], "46-50": [66375, 72204, 75627, 88069], "51-55": [92953, 100695, 105527, 123366], "56-60": [102874, 111515, 117021, 137446], "61-65": [121760, 132329, 139350, 165631], "66-70": [150054, 163611, 173004, 208479], "71-75": [191111, 209096, 222029, 271234], "76-80": [243002, 266525, 283873, 350185], "81-85": [295999, 324794, 346246, 428406], "85+": [354391, 388622, 414202, 512242] }, "2A": { "18-35": [61568, 63430, 64790, 69706], "36-45": [63885, 66477, 68415, 75571], "46-50": [68114, 74646, 77723, 89271], "51-55": [71487, 79165, 83102, 97953], "56-60": [81884, 91053, 96108, 115248], "61-65": [113250, 125618, 133186, 162043], "66-70": [160234, 177559, 189064, 233174], "71-75": [228407, 253078, 270457, 337345], "76-80": [314571, 348431, 373132, 468406], "81-85": [402592, 445200, 476709, 598274], "85+": [499592, 551218, 589577, 737489] }, "2A1C": { "18-35": [62758, 65665, 67788, 75399], "36-45": [64308, 67701, 70227, 79465], "46-50": [70861, 77922, 81385, 94270], "51-55": [84201, 92726, 97280, 114352], "56-60": [97481, 113134, 107477, 134436], "61-65": [128421, 141572, 149706, 180593], "66-70": [174765, 192805, 204823, 250753], "71-75": [242008, 285105, 267294, 353501], "76-80": [326997, 361346, 386380, 482772], "81-85": [413820, 456797, 488545, 610869], "85+": [509502, 561372, 599877, 748186] }, "2A2C": { "18-35": [63261, 66997, 69726, 79465], "36-45": [64761, 68841, 71869, 82868], "46-50": [73368, 80943, 84779, 98959], "51-55": [95402, 104748, 109900, 129125], "56-60": [110788, 121585, 127824, 151221], "61-65": [141300, 155208, 163892, 196739], "66-70": [187004, 205734, 218246, 265928], "71-75": [253318, 279192, 297417, 367254], "76-80": [337133, 371945, 397292, 494735], "81-85": [422757, 466077, 498046, 621061], "85+": [517120, 569210, 607841, 756481] }, "2A3C": { "18-35": [63597, 67509, 70366, 80529], "36-45": [65094, 69286, 72392, 83615], "46-50": [79454, 87526, 91724, 107158], "51-55": [107623, 117766, 123498, 144808], "56-60": [123483, 135056, 141860, 167283], "61-65": [153569, 168209, 177422, 212163], "66-70": [198632, 218026, 231014, 280381], "71-75": [264017, 290455, 309075, 380285], "76-80": [346657, 381906, 407549, 505976], "81-85": [431084, 474721, 506891, 630531], "85+": [524127, 576411, 615150, 764053] } } } };

    // --- Benefits Mapping ---
    const benefitsMapping = {
        "Prime": [
            ["Maternity Expenses", "Not Covered"],
            ["Health Multiplier", "Not Applicable"],
            ["ReInsure Benefit", "Unlimited up to 100% of Base SI"],
            ["Air Ambulance", "Up to ₹3,000 per hospitalization"],
            ["Enhanced Cumulative Bonus", "50% of Base SI up to 100%"],
            ["Child Vaccination", "Not Covered"]
        ],
        "Elite": [
            ["Maternity Expenses", "Not Covered"],
            ["Health Multiplier", "2X (SI 3-10L) / 3X (SI 15L+)"],
            ["ReInsure Benefit", "Unlimited up to 100% of Base SI"],
            ["Air Ambulance", "Up to ₹3,000 per hospitalization"],
            ["Enhanced Cumulative Bonus", "50% of Base SI up to 100%"],
            ["Child Vaccination", "Not Covered"]
        ],
        "Premier": [
            ["Maternity Expenses", "Up to ₹25k (Normal) / ₹50k (C-Sec)"],
            ["Health Multiplier", "2X of Base Sum Insured"],
            ["ReInsure Benefit", "Unlimited up to 100% of Base SI"],
            ["Air Ambulance", "Up to ₹4,000 per hospitalization"],
            ["Enhanced Cumulative Bonus", "50% of Base SI up to 100%"],
            ["Child Vaccination", "Not Covered"]
        ],
        "Platinum": [
            ["Maternity Expenses", "Up to ₹50k (Normal) / ₹75k (C-Sec)"],
            ["Health Multiplier", "2X (SI 10L) / 3X (SI 15L+)"],
            ["ReInsure Benefit", "Unlimited up to 100% of Base SI"],
            ["Air Ambulance", "Up to ₹5,000 per hospitalization"],
            ["Enhanced Cumulative Bonus", "50% of Base SI up to 200%"],
            ["Child Vaccination", "Up to ₹5,000 per annum"]
        ],
        "PlatinumInfinite": [
            ["Maternity Expenses", "Up to ₹2 Lakhs"],
            ["Health Multiplier", "3X of Base Sum Insured"],
            ["ReInsure Benefit", "Unlimited up to 200% of Base SI"],
            ["Air Ambulance", "Up to ₹10 Lakhs"],
            ["Loyalty Credit", "50% of Base SI up to 100%"],
            ["Child Vaccination", "Up to ₹10,000 per annum"]
        ]
    };

    // --- HELPER FUNCTIONS ---
    function getDomesticHelpRate(age, si) {
        if (age >= 18 && age <= 35) return si === 50000 ? 2085.5862 : 2404.7787;
        if (age >= 36 && age <= 45) return si === 50000 ? 2447.3377 : 2830.3687;
        if (age >= 46 && age <= 50) return si === 50000 ? 3449.7102 : 4009.6304;
        if (age >= 51 && age <= 55) return si === 50000 ? 4479.1630 : 5220.7514;
        if (age >= 56 && age <= 60) return si === 50000 ? 6438.8207 : 7421.0201;
        if (age >= 61 && age <= 65) return si === 50000 ? 8244.6635 : 9545.5411;
        if (age >= 66 && age <= 70) return si === 50000 ? 10636.4186 : 12359.3706;
        if (age >= 71 && age <= 75) return si === 50000 ? 13804.1872 : 16086.1573;
        if (age >= 76 && age <= 80) return si === 50000 ? 17999.7498 : 21022.1133;
        if (age >= 81 && age <= 85) return si === 50000 ? 23556.5778 : 27559.5579;
        if (age > 85) return si === 50000 ? 30916.3387 : 36218.1001;
        return 0;
    }

    function getReinsureCost(si, age) {
        let cost45, costAbove;
        if (si === 300000) { cost45=674.6987; costAbove=1619.2770; }
        else if (si === 500000) { cost45=567.4155; costAbove=1361.7973; }
        else if (si === 700000) { cost45=400.8407; costAbove=962.0177; }
        else if (si === 1000000) { cost45=205.2521; costAbove=492.6051; }
        else if (si >= 1500000) { cost45=55.6846; costAbove=133.6431; } 
        else { return 0; } 
        return (age <= 45) ? cost45 : costAbove;
    }

    function getBonusSafeguardCost(si) {
        if (si === 300000) return 1269.1373;
        if (si === 500000) return 1080.2181;
        if (si === 700000) return 652.8781;
        if (si === 1000000) return 402.6491;
        if (si === 1500000) return 112.5650;
        if (si >= 2000000) return 27.9722; 
        return 0; 
    }

    function getAccidentHospitalizationCost(si) {
        if (si === 300000) return 122.1476;
        if (si === 500000) return 55.2590;
        if (si === 700000) return 45.2124;
        if (si === 1000000) return 40.5400;
        if (si === 1500000) return 31.5415;
        if (si >= 2000000) return 26.3965; 
        return 0;
    }

    function getWellnessCost(variant) {
        if (variant === "Prime" || variant === "Elite" || variant === "Premier") return 1031.0;
        if (variant === "Platinum" || variant === "PlatinumInfinite") return 1417.0;
        return 0; 
    }

    // --- UI LOGIC ---
    function setPolicyType(type) {
        document.getElementById('policyType').value = type;
        document.getElementById('pill-individual').className = type === 'individual' ? 'pill-option active' : 'pill-option';
        document.getElementById('pill-floater').className = type === 'floater' ? 'pill-option active' : 'pill-option';

        const familySelect = document.getElementById('family');
        familySelect.innerHTML = '';

        if (type === 'individual') {
            addOption(familySelect, '1A', '1 Adult');
        } else {
            addOption(familySelect, '1A1C', '1 Adult + 1 Child');
            addOption(familySelect, '1A2C', '1 Adult + 2 Children');
            addOption(familySelect, '1A3C', '1 Adult + 3 Children');
            addOption(familySelect, '2A',   '2 Adults');
            addOption(familySelect, '2A1C', '2 Adults + 1 Child');
            addOption(familySelect, '2A2C', '2 Adults + 2 Children');
            addOption(familySelect, '2A3C', '2 Adults + 3 Children');
        }
    }

    function addOption(select, value, text) {
        const opt = document.createElement('option');
        opt.value = value;
        opt.text = text;
        select.add(opt);
    }

    function handleVariantChange() {
        const variant = document.getElementById('variant').value;
        const siSelect = document.getElementById('sumInsured');
        siSelect.innerHTML = '';
        
        if (db[variant]) {
            db[variant].SI.forEach(val => {
                const opt = document.createElement('option');
                opt.value = val;
                opt.text = val.toLocaleString('en-IN');
                siSelect.add(opt);
            });
        }

        let defaultSI = "1000000"; 
        if (variant === "PlatinumInfinite") defaultSI = "10000000";

        let defaultIndex = 0;
        for(let i=0; i<siSelect.options.length; i++) {
            if(siSelect.options[i].value == defaultSI) {
                defaultIndex = i;
                break;
            }
        }
        siSelect.selectedIndex = defaultIndex;
        
        // --- FEATURE VISIBILITY TOGGLES ---
        const reinsureCheck = document.getElementById('opt_reinsure');
        const reinsureLabel = document.getElementById('lbl_reinsure');
        const reinsureNote  = document.getElementById('reinsure_note');
        const bonusCheck    = document.getElementById('opt_bonus');
        const bonusLabel    = document.getElementById('lbl_bonus');
        const bonusNote     = document.getElementById('bonus_note');
        const wellnessCheck = document.getElementById('opt_wellness');
        const wellnessLabel = document.getElementById('lbl_wellness');
        
        // ReInsure & Bonus: Now Prime, Elite, Premier, Platinum
        if (variant === 'Prime' || variant === 'Elite' || variant === 'Premier' || variant === 'Platinum') {
            reinsureCheck.disabled = false;
            reinsureLabel.classList.remove('disabled');
            reinsureNote.style.display = 'none';
            bonusCheck.disabled = false;
            bonusLabel.classList.remove('disabled');
            bonusNote.style.display = 'none';
        } else {
            reinsureCheck.checked = false;
            reinsureCheck.disabled = true;
            reinsureLabel.classList.add('disabled');
            reinsureNote.style.display = 'block';
            bonusCheck.checked = false;
            bonusCheck.disabled = true;
            bonusLabel.classList.add('disabled');
            bonusNote.style.display = 'block';
        }
        wellnessCheck.disabled = false;
        wellnessLabel.classList.remove('disabled');
    }

    function getAgeBand(age) {
        if (age >= 18 && age <= 35) return '18-35';
        if (age >= 36 && age <= 45) return '36-45';
        if (age >= 46 && age <= 50) return '46-50';
        if (age >= 51 && age <= 55) return '51-55';
        if (age >= 56 && age <= 60) return '56-60';
        if (age >= 61 && age <= 65) return '61-65';
        if (age >= 66 && age <= 70) return '66-70';
        if (age >= 71 && age <= 75) return '71-75';
        if (age >= 76 && age <= 80) return '76-80';
        if (age >= 81 && age <= 85) return '81-85';
        if (age > 85) return '85+';
        return null;
    }

    // --- MATHEMATICAL CORE ---
    function getDerivedPremium(variant, family, ageBand, siIndex) {
        if (db[variant].rates[family] && db[variant].rates[family][ageBand]) {
            return parseFloat(db[variant].rates[family][ageBand][siIndex]);
        }
        const match = family.match(/(\d+)A(\d+)C/);
        if (!match) return 0;
        const adults = parseInt(match[1]);
        const children = parseInt(match[2]);
        const maxKnownChildren = 2; 
        const keyBase = adults + "A" + "1C";          
        const keyMaxKnown = adults + "A" + maxKnownChildren + "C"; 
        if (!db[variant].rates[keyBase] || !db[variant].rates[keyMaxKnown]) return 0; 
        const rateBase = parseFloat(db[variant].rates[keyBase][ageBand]?.[siIndex]);
        const rateMaxKnown = parseFloat(db[variant].rates[keyMaxKnown][ageBand]?.[siIndex]);
        if (!rateBase || !rateMaxKnown) return 0;
        const childDiff = rateMaxKnown - rateBase;
        const factor = (adults === 1) ? 0.88 : 0.70;
        const extraChildren = children - maxKnownChildren;
        let finalPremium = rateMaxKnown + (childDiff * factor * extraChildren);
        return finalPremium;
    }

    function getCombinedAnnualRateForAge(age, variant, family, si, siIndex) {
        const ageBand = getAgeBand(age);
        if(!ageBand) return null; 
        let base = getDerivedPremium(variant, family, ageBand, siIndex);
        let optional = 0;
        if (document.getElementById('opt_reinsure').checked && !document.getElementById('opt_reinsure').disabled) {
            optional += getReinsureCost(si, age);
        }
        return { base, optional };
    }

    let currentQuote = null;

    function calculate() {
        const variant = document.getElementById('variant').value;
        const family = document.getElementById('family').value;
        const startAge = parseInt(document.getElementById('age').value);
        const si = parseInt(document.getElementById('sumInsured').value);
        const errorBox = document.getElementById('errorBox');
        const calcNote = document.getElementById('calcNote');
        
        errorBox.style.display = 'none';
        calcNote.innerText = "";
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('btnDownload').style.display = 'none';
        document.getElementById('btnWhatsapp').style.display = 'none';

        if (!startAge) {
            errorBox.innerText = "Please enter valid age.";
            errorBox.style.display = 'block';
            return;
        }

        const siIndex = db[variant].SI.indexOf(si);
        if (siIndex === -1) {
            errorBox.innerText = "Sum Insured not found.";
            errorBox.style.display = 'block';
            return;
        }

        let constantOptionalAnnual = 0.0;
        let selectedOptionals = [];

        if (document.getElementById('opt_domestic').checked) {
            const staffAge = parseInt(document.getElementById('staff_age').value);
            const staffSi = parseInt(document.getElementById('staff_si').value);
            if(!staffAge) {
                errorBox.innerText = "Please enter staff age.";
                errorBox.style.display = 'block';
                return;
            }
            constantOptionalAnnual += getDomesticHelpRate(staffAge, staffSi);
            selectedOptionals.push("Domestic Help Cover");
        }

        if (document.getElementById('opt_reinsure').checked && !document.getElementById('opt_reinsure').disabled) {
            selectedOptionals.push("Enhanced ReInsure");
        }

        if (document.getElementById('opt_bonus').checked && !document.getElementById('opt_bonus').disabled) {
            constantOptionalAnnual += getBonusSafeguardCost(si);
            selectedOptionals.push("Bonus Safeguard");
        }

        if (document.getElementById('opt_accident').checked) {
            constantOptionalAnnual += getAccidentHospitalizationCost(si);
            selectedOptionals.push("Accident Hospitalization");
        }

        if (document.getElementById('opt_wellness').checked && !document.getElementById('opt_wellness').disabled) {
            constantOptionalAnnual += getWellnessCost(variant);
            selectedOptionals.push("Wellness Benefit (Gym)");
        }

        const termDiscounts = [0, 0.04, 0.06]; 
        
        currentQuote = {
            variant: variant,
            family: family,
            age: startAge,
            si: si,
            selectedOptionals: selectedOptionals,
            results: []
        };

        for(let tenure = 1; tenure <= 3; tenure++) {
            let totalBaseForTenure = 0.0;
            let totalOptionalForTenure = 0.0;
            let validCalculation = true;

            for(let yr = 0; yr < tenure; yr++) {
                let currentAge = startAge + yr;
                let rates = getCombinedAnnualRateForAge(currentAge, variant, family, si, siIndex);
                if(!rates) { validCalculation = false; break; }
                totalBaseForTenure += rates.base;
                totalOptionalForTenure += (rates.optional + constantOptionalAnnual);
            }

            if(!validCalculation) {
                document.getElementById(`total_${tenure}`).innerText = "N/A";
                continue;
            }

            let grossPremium = totalBaseForTenure + totalOptionalForTenure;
            let discountRate = termDiscounts[tenure-1];
            let discountAmount = grossPremium * discountRate;
            let netPremium = grossPremium - discountAmount;
            
            let finalDisplay = Math.floor(netPremium);
            let displayBase = Math.round(totalBaseForTenure);
            let displayOpt = Math.round(totalOptionalForTenure);

            document.getElementById(`base_${tenure}`).innerText = "₹ " + displayBase.toLocaleString('en-IN');
            document.getElementById(`opt_${tenure}`).innerText = "₹ " + displayOpt.toLocaleString('en-IN');
            document.getElementById(`total_${tenure}`).innerText = "₹ " + finalDisplay.toLocaleString('en-IN');

            currentQuote.results.push({
                tenure: tenure + " Year(s)",
                base: displayBase,
                optional: displayOpt,
                discount: discountRate > 0 ? Math.round(discountAmount) : 0,
                final: finalDisplay
            });
        }
        
        calcNote.innerText = "Multi-year premiums account for age progression. GST not included.";
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('btnDownload').style.display = 'flex';
        document.getElementById('btnWhatsapp').style.display = 'flex';
    }

    document.getElementById('opt_domestic').addEventListener('change', function() {
        document.getElementById('domestic_inputs').style.display = this.checked ? 'block' : 'none';
    });

    // --- PDF GENERATION & SHARE ---
    async function generateAndAction(action) {
        if(!currentQuote) return;

        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const primaryColor = [40, 0, 113];

            // 1. Header
            doc.setFillColor(...primaryColor); 
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("SBI Super Health Insurance", 105, 18, null, null, "center");
            doc.setFontSize(12);
            doc.text("Premium Quote (Excl. Tax)", 105, 28, null, null, "center");

            // 2. Customer Details Grid
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            
            const startY = 50;
            doc.setFont("helvetica", "bold");
            doc.text("Plan Details:", 14, 48);
            doc.setFont("helvetica", "normal");
            
            doc.text(`Variant: ${currentQuote.variant}`, 14, 55);
            doc.text(`Policy Type: ${document.getElementById('policyType').value.toUpperCase()}`, 14, 61);
            doc.text(`Family Size: ${currentQuote.family}`, 14, 67);
            
            doc.text(`Age of Eldest: ${currentQuote.age} Years`, 110, 55);
            doc.text(`Sum Insured: INR ${currentQuote.si.toLocaleString('en-IN')}`, 110, 61);
            
            // Selected Optionals Text
            let optText = currentQuote.selectedOptionals.length > 0 ? currentQuote.selectedOptionals.join(", ") : "None";
            doc.text(`Selected Add-ons: ${optText}`, 14, 75);

            // 3. Premium Table
            const premiumBody = currentQuote.results.map(row => [
                row.tenure,
                row.base.toLocaleString('en-IN'),
                row.optional.toLocaleString('en-IN'),
                row.discount > 0 ? "-" + row.discount.toLocaleString('en-IN') : "0",
                row.final.toLocaleString('en-IN')
            ]);

            doc.autoTable({
                startY: 80,
                head: [['Tenure', 'Total Base', 'Total Optional', 'Term Discount', 'Net Premium (₹)']],
                body: premiumBody,
                theme: 'grid',
                headStyles: { fillColor: primaryColor, halign: 'center' },
                styles: { fontSize: 10, halign: 'center' },
                columnStyles: { 4: { fontStyle: 'bold' } }
            });

            // 4. Benefits Table (New Section)
            let finalY = doc.lastAutoTable.finalY + 10;
            
            // Title
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(40, 0, 113);
            doc.text(`Key Benefits - ${currentQuote.variant} Plan`, 14, finalY);
            
            // Get benefits data
            const benefitData = benefitsMapping[currentQuote.variant];
            
            doc.autoTable({
                startY: finalY + 5,
                head: [['Benefit', 'Coverage Detail']],
                body: benefitData,
                theme: 'grid',
                headStyles: { fillColor: [0, 145, 208] }, // Secondary Blue
                styles: { fontSize: 9, cellPadding: 2 },
                columnStyles: { 
                    0: { cellWidth: 70, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                }
            });

            // 5. Footer
            const pageHeight = doc.internal.pageSize.height;
            doc.setFontSize(8);
            doc.setTextColor(100);
            doc.setFont("helvetica", "italic");
            doc.text("Disclaimer: This quote is for illustrative purposes. Final premium subject to underwriting.", 14, pageHeight - 15);
            doc.text("GST is NOT included in the figures above.", 14, pageHeight - 10);

            // ACTION: Download or WhatsApp
            if(action === 'download') {
                doc.save("SBI_Super_Health_Quote.pdf");
            } else if(action === 'whatsapp') {
                // Generate PDF as Blob
                const pdfBlob = doc.output('blob');
                const file = new File([pdfBlob], "SBI_Health_Quote.pdf", { type: "application/pdf" });

                // Use Web Share API
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'SBI Health Insurance Quote',
                            text: 'Here is the requested SBI Super Health Insurance premium quote.'
                        });
                    } catch (err) {
                        console.log('Share was canceled or failed', err);
                    }
                } else {
                    alert("Your device/browser does not support direct file sharing to WhatsApp. The PDF has been downloaded. Please attach it manually.");
                    doc.save("SBI_Super_Health_Quote.pdf");
                }
            }

        } catch (e) {
            alert("Error generating PDF. Please ensure internet connection to load PDF libraries.");
            console.error(e);
        }
    }

    window.onload = function() {
        setPolicyType('individual');
        handleVariantChange();
    };

</script>

</body>
</html>
